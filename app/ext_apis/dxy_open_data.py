# {'abroadRemark': [''],
#  'confirmedCount': ['80717'],
#  'confirmedIncr': ['152.0'],
#  'countRemark': [''],
#  'curedCount': ['53909'],
#  'curedIncr': ['1800.0'],
#  'currentConfirmedCount': ['23763.0'],
#  'currentConfirmedIncr': ['-1678.0'],
#  'dailyPic': ['https://img1.dxycdn.com/2020/0211/763/3395998884005602079-135.png,https://img1.dxycdn.com/2020/0211/362/3395998896890788910-135.png,https://img1.dxycdn.com/2020/0211/365/3395998905480724211-135.png,https://img1.dxycdn.com/2020/0211/364/3395998916217859778-135.png,https://img1.dxycdn.com/2020/0211/922/3395998929103046444-135.png,https://img1.dxycdn.com/2020/0211/089/3395998939840182072-135.png'],
#  'dailyPics': ["['https://img1.dxycdn.com/2020/0211/763/3395998884005602079-135.png', "
#                "'https://img1.dxycdn.com/2020/0211/362/3395998896890788910-135.png', "
#                "'https://img1.dxycdn.com/2020/0211/365/3395998905480724211-135.png', "
#                "'https://img1.dxycdn.com/2020/0211/364/3395998916217859778-135.png', "
#                "'https://img1.dxycdn.com/2020/0211/922/3395998929103046444-135.png', "
#                "'https://img1.dxycdn.com/2020/0211/089/3395998939840182072-135.png']"],
#  'deadCount': ['3045'],
#  'deadIncr': ['30.0'],
#  'foreignStatistics': ["{'currentConfirmedCount': 17298, 'confirmedCount': "
#                        "19310, 'suspectedCount': 0, 'curedCount': 1656, "
#                        "'deadCount': 356, 'suspectedIncr': 0, "
#                        "'currentConfirmedIncr': 3479, 'confirmedIncr': 4070, "
#                        "'curedIncr': 504, 'deadIncr': 87}"],
#  'foreignTrendChart': ["[{'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/379/3400441557374299700-135.png', "
#                        "'title': '国外新增确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/667/3400441578849442998-135.png', "
#                        "'title': '国外累计确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/722/3400441611061392551-135.png', "
#                        "'title': '国外死亡'}]"],
#  'generalRemark': ['疑似病例数来自国家卫健委数据，目前为全国数据，未分省市自治区等。浙江省 12 例外省治愈暂无具体省份信息。'],
#  'hbFeiHbTrendChart': ["[{'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/768/3400489255133955947-135.png', "
#                        "'title': '湖北新增确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/884/3400489268018858436-135.png', "
#                        "'title': '非湖北新增确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/937/3400457407951513355-135.png', "
#                        "'title': '湖北现存确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/032/3400457491703379802-135.png', "
#                        "'title': '非湖北现存确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/625/3400457511030733392-135.png', "
#                        "'title': '治愈/死亡'}]"],
#  'importantForeignTrendChart': ["[{'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/671/3400441654011066923-135.png', "
#                                 "'title': '韩国新增确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/030/3400441679781177630-135.png', "
#                                 "'title': '韩国累计确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/241/3400441711993433692-135.png', "
#                                 "'title': '日本新增确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/774/3400441742057899653-135.png', "
#                                 "'title': '日本累计确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/716/3400441778565428997-135.png', "
#                                 "'title': '意大利新增确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/491/3400441802187443870-135.png', "
#                                 "'title': '意大利累计确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/161/3400441858022020838-135.png', "
#                                 "'title': '伊朗新增确诊'}, {'imgUrl': "
#                                 "'https://img1.dxycdn.com/2020/0306/444/3400441881644647738-135.png', "
#                                 "'title': '伊朗累计确诊'}]"],
#  'infectSource': ['该字段已替换为说明2'],
#  'marquee': ["[{'id': 1068, 'marqueeLabel': '最美', 'marqueeContent': "
#              "'落日余晖下的这个瞬间，刻骨铭心', 'marqueeLink': 'https://dxy.me/JTvupn'}, "
#              "{'id': 1069, 'marqueeLabel': '卫健委', 'marqueeContent': '部分疫苗有望 4 "
#              "月进入应急使用', 'marqueeLink': 'https://dxy.me/H2UWQ6'}, {'id': 1070, "
#              "'marqueeLabel': '卫健委', 'marqueeContent': '已累计报告境外输入确诊病例 36 例', "
#              "'marqueeLink': 'https://dxy.me/sJBWju'}]"],
#  'note1': ['病毒：SARS-CoV-2，其导致疾病命名 COVID-19'],
#  'note2': ['传染源：新冠肺炎的患者。无症状感染者也可能成为传染源。'],
#  'note3': ['传播途径：经呼吸道飞沫、接触传播是主要的传播途径。气溶胶传播和消化道等传播途径尚待明确。'],
#  'passWay': ['该字段已替换为说明3'],
#  'quanguoTrendChart': ["[{'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/183/3400489132727383584-135.png', "
#                        "'title': '新增疑似/新增确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/653/3400487766927497685-135.png', "
#                        "'title': '现存确诊'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/985/3400489233658885439-135.png', "
#                        "'title': '现存疑似'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/925/3400487803434721284-135.png', "
#                        "'title': '治愈'}, {'imgUrl': "
#                        "'https://img1.dxycdn.com/2020/0306/175/3400487816319857732-135.png', "
#                        "'title': '死亡'}]"],
#  'remark1': ['易感人群：人群普遍易感。老年人及有基础疾病者感染后病情较重，儿童及婴幼儿也有发病'],
#  'remark2': ['潜伏期：一般为 3～7 天，最长不超过 14 天，潜伏期内可能存在传染性，其中无症状病例传染性非常罕见'],
#  'remark3': ['宿主：野生动物，可能为中华菊头蝠'],
#  'remark4': [''],
#  'remark5': [''],
#  'seriousCount': ['5737.0'],
#  'seriousIncr': ['-215.0'],
#  'summary': [''],
#  'suspectedCount': ['482'],
#  'suspectedIncr': ['102.0'],
#  'updateTime': ['2020-03-06 20:50:02.299'],
#  'virus': ['该字段已替换为说明1'],
#  '\ufeff_id': ['5e6246fab6566dbae26457ed']}

import csv
import json


def load_ncov_data(filepath='cache_ext_data/DXYOverall.csv'):
    with open(filepath, 'r') as f:
        reader = csv.reader(f)
        headers = next(reader, None)
        column = {}
        for h in headers:
            column[h] = []

        country_mapping = {
            '韩国新增确诊': 'korea_new',
            '韩国累计确诊': 'korea_acc',
            '日本新增确诊': 'japan_new',
            '日本累计确诊': 'japan_acc',
            '意大利新增确诊': 'italy_new',
            '意大利累计确诊': 'italy_acc',
            '伊朗新增确诊': 'iran_new',
            '伊朗累计确诊': 'iran_acc',
        }
        for row in reader:
            for h, v in zip(headers, row):
                column[h].append(v)
            # only load 1 record (newest data)
            important_foreign_trend_chart = column['importantForeignTrendChart'][0].replace('\'', '\"')
            # print(importantForeignTrendChart)
            d = json.loads(important_foreign_trend_chart)
            country_image_url = {}
            for item in d:
                title = item['title']
                img_url = item['imgUrl']
                country_image_url[country_mapping[title]] = img_url
            break
        return country_image_url


if __name__ == '__main__':
    load_ncov_data('DXYOverall.csv')
